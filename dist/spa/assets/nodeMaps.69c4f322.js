import{Q,b as J,a as V,c as T,_ as A}from"./tyeng.a690c00e.js";import{o as F,t as $,w as j,R as E,r as B,q as U,s as p,y as n,B as i,z as f,ae as q,E as e,x as I,C as L,F as v,D as r,G as _,M,A as x,H as h,Q as y,v as w,I as C,af as R,ag as Y,ah as H,ai as P,P as X,L as z}from"./index.9b424d6f.js";import{Q as D}from"./QCardActions.b3c92032.js";import{Q as m}from"./QInput.18331260.js";import{Q as k,C as S,a as G}from"./ClosePopup.eb9ca650.js";const K={class:"q-ml-sm"},W={class:"q-pa-md"},Z=e("thead",null,[e("tr",null,[e("th",{style:{width:"10%"}},"\uB9F5ID"),e("th",{style:{width:"80%"}},[e("div",{class:"text-center"},"\uB9F5")]),e("th",{style:{width:"5%"}}),e("th",{style:{width:"5%"}})])],-1),ee={width:"100px"},te={width:"100px"},oe={width:"100px"},se={class:"q-pa-md"},le=e("td",{width:"100px"},null,-1),ne=e("td",{width:"100px"},null,-1),ae=e("td",{align:"right",width:"100px"},"\uB9F5\uC544\uC774\uB514",-1),ie={width:"200px"},de={width:"300px"},re={width:"100px"},ce={key:0,class:"q-pa-md"},pe=e("div",{class:"text-h4 text-center"},"\uD3EC\uD2B8\uC124\uC815",-1),ue={class:"table"},me=e("thead",null,[e("tr",null,[e("th",{style:{width:"9%"}}),e("th",{style:{width:"1%"}}),e("th",{style:{width:"10%"}}),e("th",{style:{width:"40%"}}),e("th",{style:{width:"10%"}}),e("th",{style:{width:"10%"}}),e("th",{style:{width:"10%"}}),e("th",{style:{width:"10%"}})])],-1),fe=e("td",null,"Class",-1),he=e("td",null,":",-1),_e={colspan:"3"},ye={key:0,align:"left"},ge={key:0},Ie=e("div",{class:"text-right"},"\uAC1C\uD3D0\uAE30 \uD3EC\uD2B8\uC218",-1),ve=[Ie],Ce={key:1},Se=e("td",null,"Type",-1),be=e("td",null,":",-1),we=e("td",{colspan:"5"},null,-1),xe=e("td",null,"Model",-1),ke=e("td",null,":",-1),Me=e("td",{colspan:"5"},null,-1),Ne=e("td",null,"Name",-1),Oe=e("td",null,":",-1),Ve={width:"200px"},Te=e("td",{colspan:"5"},null,-1),De=e("td",null,"CommSpec",-1),Qe=e("td",null,":",-1),Je=e("td",null,[e("div",{class:"col text-right"},"\uC77D\uAE30\uC2DC\uC791\uC8FC\uC18C")],-1),Ae={class:"col text-left"},Fe=e("td",null,[e("div",{class:"col text-right"},"\uC4F0\uAE30\uC2DC\uC791\uC8FC\uC18C")],-1),$e={class:"col text-left"},je={align:"right"},Ee={colspan:"6"},Be=e("br",null,null,-1),Ue={key:0},qe={align:"right"},Le={colspan:"7"},Re=e("img",{src:A},null,-1),Ye=M("\uD2F0\uC640\uC774\uC774\uC5D4\uC9C0 \uC2A4\uB9C8\uD2B8 \uC81C\uC5B4 "),We={name:"nodeMaps",setup(He){const d=F("smartFarm"),N=$(d,"msg");j(N,s=>{if(s.topic.startsWith("nodeMaps"))var o=s.topic.split("/")[1];else return;switch(String(o)){case"deviceCodes":console.log("msg",s),s.payload.length===0?O("./deviceCodes.json",function(t){const a=JSON.parse(t);a.forEach((c,b)=>{var g={collection:"deviceCodes",operation:"insertOne",payload:c};g.topic="nodeMaps/insertDeviceCode",d.send(g),b===a.length-1&&d.send({topic:"nodeMaps/defaultMaps",collection:"defaultMaps",operation:"find.toArray"})})}):(l.deviceCodes=JSON.parse(JSON.stringify(s.payload)),d.send({topic:"nodeMaps/defaultMaps",collection:"defaultMaps",operation:"find.toArray"}));break;case"defaultMaps":s.payload.length===0?O("./defaultMaps.json",function(t){const a=JSON.parse(t);a.forEach((c,b)=>{var g={collection:"defaultMaps",operation:"insertOne",payload:c};g.topic="nodeMaps/insertMap",d.send(g),b===a.length-1&&d.send({topic:"nodeMaps/registerMaps",collection:"registerMaps",operation:"find.toArray"})}),console.log(data)}):d.send({topic:"nodeMaps/registerMaps",collection:"registerMaps",operation:"find.toArray"});case"registerMaps":s.payload.forEach(t=>{l.registerMaps[t._id]={},l.registerMaps[t._id]=JSON.parse(JSON.stringify(t)),s.topic==="registerMaps"?l.registerMaps[t._id].collection="registerMaps":l.registerMaps[t._id].collection="defaultMaps"}),o==="registerMaps"&&d.send({topic:"nodeMaps/deviceNodes",collection:"deviceNodes",operation:"find.toArray"});break;case"insertMap":l.copied="\uB9F5\uC774 \uCD94\uAC00 \uB418\uC5C8\uC2B5\uB2C8\uB2E4.",setTimeout(()=>{l.copied=""},3e3);break;case"updateMap":l.copied="\uB9F5\uC774 \uAC31\uC2E0 \uB418\uC5C8\uC2B5\uB2C8\uB2E4.",setTimeout(()=>{l.copied=""},3e3);break;case"deleteMap":l.copied="\uB9F5\uC774 \uC0AD\uC81C \uB418\uC5C8\uC2B5\uB2C8\uB2E4.",setTimeout(()=>{l.copied=""},3e3);break;case"insertDeviceCodes":l.copied="\uC7A5\uCE58\uCF54\uB4DC\uAC00 \uCD94\uAC00\uB418\uC5C8\uC2B5\uB2C8\uB2E4.",setTimeout(()=>{l.copied=""},3e3);break}});let u=E({alert:!1,icon:"delete",label:"",text:"",yesNo:!0,onClick:{},data:null});const l=B({copied:"",mapInfo:{_id:null,show:!1,sensorShow:!1,actuatorShow:!1,isTYNode:!1,isDefault:!0,noOfDualChannels:8,sensors:[],actuators:[],actautorRetractable:{Class:"actuator",Type:"retractable/level2",Model:"MOTOR-LV2",Name:"",CommSpec:{"KS X 3265":{read:{"starting-register":0,items:["status","opid","state-hold-time","remain-time","opentime","closetime"]},write:{"starting-register":0,items:["status","opid","state-hold-time","remain-time","ratio"]}}}},actautorSwitch:{Class:"actuator",Type:"switch/level2",Model:"SWITCH-LV2",Name:"\uC2A4\uC704\uCE581",CommSpec:{"KS X 3265":{read:{"starting-register":0,items:["operation","opid","position","opentime","closetime"]},write:{"starting-register":0,items:["operation","opid","hold-time","ratio"]}}}},CommSpec:{read:{"starting-register":0},write:{"starting-register":0}}},selectedMap:{Devices:[]},deviceShow:!1,registerMaps:{},copyMap:function(s){var o=document.createElement("textarea");o.value=s,o.setAttribute("readonly",""),o.style={position:"absolute",left:"-9999px"},document.body.appendChild(o),o.select();try{var t=document.execCommand("copy");t&&(this.copied="\uBA54\uBAA8\uB9AC\uC5D0 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4"),setTimeout(()=>{this.copied=""},3e3)}catch{this.copied="\uC5D0\uAD6C, \uBCF5\uC0AC \uC2E4\uD328",setTimeout(()=>{this.copied=""}),document.body.removeChild(o)}},chooseFile:function(s){if(console.log("chooseFile"),console.log(s.target.files[0].name),s.target.files[0]!==void 0&&s.target.files[0].name.includes(".json")){const o=new FileReader;o.onload=t=>{var a=JSON.parse(t.target.result)[0];console.log("fileMap",a),a._id!==void 0||a.Class!==void 0||a.Type!==void 0||a.Model!==void 0||a.Name!==void 0||a.CommSpec!==void 0?this.editMap(a):u.value={icon:"report_problem",alert:!0,label:"\uC120\uD0DD\uC624\uB958",text:"\uB9F5 \uD30C\uC77C\uC774 \uC544\uB2D9\uB2C8\uB2E4",yesNo:!1}},o.onerror=t=>console.log(t),o.readAsText(s.target.files[0])}else u.value={icon:"report_problem",alert:!0,label:"\uC120\uD0DD\uC624\uB958",text:"\uD30C\uC77C\uC744 \uC77D\uC744\uC218\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.",yesNo:!1}},addMap:function(){if(this.mapInfo._id!==null&&this.mapInfo._id.length>0){console.log(this.mapInfo._id);var s={};if(Object.keys(this.registerMaps).includes(this.mapInfo._id))u.value={icon:"report_problem",alert:!0,label:"\uC120\uD0DD\uC624\uB958",text:"\uAC19\uC740 \uC774\uB984\uC758 \uB9F5\uC544\uC774\uB514\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4",yesNo:!1};else{s._id=this.mapInfo._id,s.class=this.mapInfo.class,s.type=this.mapInfo.type,s.model=this.mapInfo.model,s.name=this.mapInfo.name,s.commSpec=this.mapInfo.commSpec,s.devices=[],this.mapInfo.actuators.length>0&&this.mapInfo.actuators.forEach(t=>{s.devices.push(t)}),this.mapInfo.sensors.length>0&&this.mapInfo.sensors.forEach(t=>{s.devices.push(t)}),this.registerMaps[s._id]=s;var o={collection:"registerMaps",operation:"insertOne",payload:s};o.topic="nodeMaps/insertMap",d.send(o)}}else console.log("empty map id")},editMap:function(s){console.log("registerMap",s),console.log("this.selectMap.name",this.mapInfo.name),this.mapInfo._id!==void 0&&this.mapInfo._id!==s._id?this.mapInfo.show=!0:this.mapInfo.show=!this.mapInfo.show,this.mapInfo.show&&(console.log(s),this.mapInfo._id=s._id,this.mapInfo.class=s.Class,this.mapInfo.type=s.Type,this.mapInfo.model=s.Model,this.mapInfo.name=s.Name,this.mapInfo.commSpec=s.CommSpec[Object.keys(s.CommSpec)[0]],this.mapInfo.actuators=[],this.mapInfo.sensors=[],console.log(this.mapInfo),String(s._id).includes("ty")&&s.Model.includes("TY-")?this.mapInfo.isTYNode=!0:this.mapInfo.isTYNode=!1,String(s._id).includes("default")?this.mapInfo.isDefault=!0:this.mapInfo.isDefault=!1,s.Devices.filter(o=>o.Class==="sensor").length>0&&(this.mapInfo.sensors=s.Devices.slice().filter(o=>o.Class==="sensor"),this.mapInfo.sensorShow=!0,console.log(this.mapInfo.sensors)),s.Devices.filter(o=>o.Class==="actuator").length>0&&(this.mapInfo.actuators=s.Devices.slice().filter(o=>o.Class==="actuator"),this.mapInfo.actuatorShow=!0,this.mapInfo.noOfDualChannels=this.mapInfo.actuators.filter(o=>o.Model.indexOf("MOTOR")>-1).length,console.log(this.mapInfo.actuators),console.log("noOfDualChannels",this.mapInfo.noOfDualChannels)),console.log(this.mapInfo))},deleteMap:function(s){u.value={icon:"priority_high",alert:!0,label:"\uC7AC\uC2DC\uC791",text:this.registerMaps[s]._id+"\uB97C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",data:{collection:"registerMaps",operation:"deleteOne",payload:{_id:s}},onClick:function(){delete l.registerMaps[this.data.payload._id],this.data.topic="nodeMaps/deleteMap",d.send(this.data)},yesNo:!0}},updateDevice:function(s,o){if(console.log(o),o.Class=="sensor"){var t=Object.keys(o.CommSpec)[0];o.CommSpec[t].read["starting-register"]=210+s*10,console.log(o),this.mapInfo.sensors[s]=JSON.parse(JSON.stringify(o))}else o.Class=="actuator"},saveDevice:function(a,o,t){console.log(a),console.log(o),console.log(JSON.parse(JSON.stringify(t)));var a="Devices."+a,c={collection:"registerMaps",operation:"updateOne",payload:[{_id:o},{$set:{[a]:t}},{upsert:!0}]};c.topc="nodeMaps/updateMap",d.send(c)}}),O=(s,o)=>{var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",s,!0),t.onreadystatechange=function(){t.readyState===4&&t.status=="200"&&o(t.responseText)},t.send(null)};return U(()=>{console.log("ndoeConfig is mounted",d.isController),N.value=d.msg,d.send({topic:"nodeMaps/deviceCodes",collection:"deviceCodes",operation:"find.toArray"})}),(s,o)=>(r(),p(v,null,[n(q,{modelValue:f(u).alert,"onUpdate:modelValue":o[1]||(o[1]=t=>f(u).alert=t),persistent:""},{default:i(()=>[n(J,{style:{width:"300px"}},{default:i(()=>[n(V,{class:"row items-center"},{default:i(()=>[n(T,{icon:f(u).icon,color:"primary","text-color":"white"},null,8,["icon"]),e("span",K,_(f(u).label),1)]),_:1}),n(V,{class:"q-pt-none"},{default:i(()=>[M(_(f(u).text),1)]),_:1}),f(u).yesNo?(r(),x(D,{key:0,align:"right"},{default:i(()=>[h(n(y,{class:"glossy",round:"",color:"deep-orange",label:"\uC608",style:{width:"60px"},onClick:o[0]||(o[0]=t=>f(u).onClick(f(u).param))},null,512),[[S]]),h(n(y,{class:"glossy",round:"",color:"primary",label:"\uC544\uB2C8\uC624",style:{width:"60px"}},null,512),[[S]])]),_:1})):(r(),x(D,{key:1,align:"right"},{default:i(()=>[h(n(y,{class:"glossy",round:"",color:"primary",label:"\uD655\uC778",style:{width:"60px"}},null,512),[[S]])]),_:1}))]),_:1})]),_:1},8,["modelValue"]),e("div",W,[n(k,null,{default:i(()=>[Z,e("tbody",null,[(r(!0),p(v,null,w(l.registerMaps,t=>(r(),p("tr",{key:t._id},[e("td",ee,_(t._id),1),e("td",null,[n(m,{dense:"",outlined:"",readonly:"",type:"text",label:JSON.stringify(t),onClick:a=>l.copyMap(JSON.stringify(t))},null,8,["label","onClick"])]),e("td",te,[h(n(y,{class:"glossy",rounded:"",color:"primary",label:"\uAE30\uBCF8",style:{width:"100px"}},null,512),[[S],[C,String(t._id).includes("default")]]),h(n(y,{class:"glossy",rounded:"",color:"info",label:"\uC124\uC815",style:{width:"100px"},onClick:a=>l.editMap(l.registerMaps[t._id])},null,8,["onClick"]),[[C,!String(t._id).includes("default")]])]),e("td",oe,[h(n(y,{class:"glossy",rounded:"",color:"green",label:"\uC0AD\uC81C",style:{width:"100px"},onClick:a=>s.deleteMap(t._id)},null,8,["onClick"]),[[C,!(String(t._id).includes("default")||String(t._id).includes("Base")||String(t._id).includes("CP"))]])])]))),128))])]),_:1})]),e("div",se,[n(k,null,{default:i(()=>[e("tbody",null,[e("tr",null,[e("td",null,_(l.copied),1),le,ne,ae,e("td",ie,[n(m,{dense:"",outlined:"",type:"text"})]),e("td",de,[e("input",{type:"file",onChange:o[2]||(o[2]=t=>l.chooseFile(t)),accept:".json"},null,32)]),e("td",re,[n(y,{class:"glossy",rounded:"",color:"red",label:"\uCD94\uAC00",style:{width:"100px"},onClick:o[3]||(o[3]=t=>l.addMap())})])])])]),_:1})]),l.mapInfo.show?(r(),p("div",ce,[pe,n(k,null,{default:i(()=>[e("table",ue,[me,e("tbody",null,[e("tr",null,[fe,he,e("td",null,[n(m,{dense:"",outlined:"",type:"text",modelValue:l.mapInfo.class,"onUpdate:modelValue":o[4]||(o[4]=t=>l.mapInfo.class=t)},null,8,["modelValue"])]),e("td",_e,[l.mapInfo.actuatorShow?(r(),p("p",ye," \uAD6C\uB3D9\uAE30 \uC81C\uC5B4\uD3EC\uD2B8 \uCD1D 16\uAC1C, \uAC1C\uD3D0\uAE30 \uD558\uB098\uC5D0 \uB450 \uAC1C\uD3EC\uD2B8 \uC0AC\uC6A9, \uB098\uBA38\uC9C0\uB294 \uC2A4\uC704\uCE58\uD3EC\uD2B8\uAC00 \uB41C\uB2E4. ")):I("",!0)]),l.mapInfo.actuatorShow?(r(),p("td",ge,ve)):I("",!0),l.mapInfo.actuatorShow?(r(),p("td",Ce,[n(m,{dense:"",outlined:"",type:"number",modelValue:l.mapInfo.noOfDualChannels,"onUpdate:modelValue":o[5]||(o[5]=t=>l.mapInfo.noOfDualChannels=t)},null,8,["modelValue"])])):I("",!0)]),e("tr",null,[Se,be,e("td",null,[n(m,{dense:"",outlined:"",type:"text",modelValue:l.mapInfo.type,"onUpdate:modelValue":o[6]||(o[6]=t=>l.mapInfo.type=t)},null,8,["modelValue"])]),we]),e("tr",null,[xe,ke,e("td",null,[n(m,{dense:"",outlined:"",type:"text",modelValue:l.mapInfo.model,"onUpdate:modelValue":o[7]||(o[7]=t=>l.mapInfo.model=t)},null,8,["modelValue"])]),Me]),e("tr",null,[Ne,Oe,e("td",Ve,[n(m,{dense:"",outlined:"",type:"text",modelValue:l.mapInfo.name,"onUpdate:modelValue":o[8]||(o[8]=t=>l.mapInfo.name=t)},null,8,["modelValue"])]),Te]),e("tr",null,[De,Qe,e("td",{colspan:"2",onClick:o[9]||(o[9]=t=>l.copyMap(JSON.stringify(l.mapInfo.commSpec)))},_(l.mapInfo.commSpec),1),Je,e("td",null,[e("div",Ae,[n(m,{dense:"",outlined:"",type:"text",modelValue:l.mapInfo.commSpec.read["starting-register"],"onUpdate:modelValue":o[10]||(o[10]=t=>l.mapInfo.commSpec.read["starting-register"]=t)},null,8,["modelValue"])])]),Fe,e("td",null,[e("div",$e,[n(m,{dense:"",outlined:"",type:"text",modelValue:l.mapInfo.commSpec.write["starting-register"],"onUpdate:modelValue":o[11]||(o[11]=t=>l.mapInfo.commSpec.write["starting-register"]=t)},null,8,["modelValue"])])])])]),h(e("tbody",null,[(r(!0),p(v,null,w(l.mapInfo.sensors,(t,a)=>(r(),p("tr",{key:a},[e("td",je,"\uC13C\uC11C"+_(a*1+1),1),e("td",Ee,[n(m,{dense:"",outlined:"",type:"text",label:JSON.stringify(t),onClick:c=>s.nodeMap.copyMap(JSON.stringify(t))},null,8,["label","onClick"])]),e("td",null,[h(n(G,{color:"warning","text-color":"black",label:"\uC124\uC815"},{default:i(()=>[n(R,null,{default:i(()=>[(r(!0),p(v,null,w(l.deviceCodes.filter(c=>c.device.Class==="sensor"),c=>h((r(),x(P,{clickable:"",key:c._id,onClick:b=>l.updateDevice(a,c.device)},{default:i(()=>[n(Y,null,{default:i(()=>[n(H,null,{default:i(()=>[M(_(c.device.Name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[S]])),128))]),_:2},1024)]),_:2},1536),[[C,l.mapInfo.isTYNode]])])]))),128))],512),[[C,l.mapInfo.sensorShow]]),Be,l.mapInfo.actuatorShow?(r(),p("tbody",Ue,[(r(!0),p(v,null,w(l.mapInfo.actuators,(t,a)=>(r(),p("tr",{key:a},[e("td",qe,"\uAD6C\uB3D9\uAE30"+_(a*1+1),1),e("td",Le,[n(m,{dense:"",outlined:"",type:"text",label:JSON.stringify(t),onClick:c=>s.nodeMap.copyMap(JSON.stringify(t))},null,8,["label","onClick"])])]))),128))])):I("",!0)])]),_:1})])):I("",!0),n(Q,{bordered:"",class:L(f(d).color[f(d).menuIndex].bg)},{default:i(()=>[n(X,null,{default:i(()=>[n(z,null,{default:i(()=>[n(T,null,{default:i(()=>[Re]),_:1}),Ye]),_:1})]),_:1})]),_:1},8,["class"])],64))}};export{We as default};
